<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
	 xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">
	<Fragment>
		<util:RegistrySearch Id="SqlInstanceKeyFoundSearch"
						Root="HKLM"
						Key="SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL"
						Value="[InstanceName]"
						Result="exists"
						Variable="SqlInstanceKeyFound" />

		<PackageGroup Id="SQLServerExpress2022FirstRun">
			<ExePackage DisplayName="Installing SQL Server Express 2022"
						CacheId="SQLServerExpress2022"
						PerMachine="yes"
						Vital="yes"
						Permanent="no"
						InstallArguments='/qs /ACTION="Install" /FEATURES=[SqlFeatures] /INSTANCENAME="[InstanceName]" /IACCEPTSQLSERVERLICENSETERMS=true /UPDATEENABLED=false /USEMICROSOFTUPDATE=false [SqlArguments]'
						UninstallArguments='/qs /Action="Uninstall" /INSTANCENAME="[InstanceName]" /FEATURES=SQLENGINE /HIDECONSOLE'
						InstallCondition="NOT (SqlInstanceKeyFound)"
						DetectCondition="SqlInstanceKeyFound">
				<ExePackagePayload
					    Id="SQLServerExpress2022FirstRun"
						Name="SQLEXPR_x64_ENU.exe"
						DownloadUrl="https://download.microsoft.com/download/3/8/d/38de7036-2433-4207-8eae-06e247e17b25/SQLEXPR_x64_ENU.exe"
						Compressed="no"
						Description="Microsoft SQL Server 2022"
						Hash="8B47CB0D1887F7D404B62AF86344853FEA1D91B6FE66F17389BF5830AB06980ED2039A6D415782D9C792D30DFD0A83FE2F4AE259487E167ABD25AE9AAACC9FF2"
						ProductName="Microsoft SQL Server 2022"
						Size="279293816" 
						Version="16.0.1000.6"  />
				
				<!-- Ignore the error code 0x84BC06BA - caused by C:\Program Files\Microsoft\AzureAttestService\AzureAttestServiceInstaller.exe -Install AzureAttestService.dll -->
				<!-- The AzureAttestService was installed, but it cannot be started on ARM64. Running the installation again no longer attempts to start the service and the installation simply continues. -->
				<ExitCode Value="-2068052294" Behavior="success" />
			</ExePackage>
		</PackageGroup>
	</Fragment>
</Wix>